
## Техническое задание (адаптировано для macOS)  
### Цель  
Разработать методику и/или инструмент для **извлечения и локального сохранения** файлов `ibss`, `ibec`, `diag`, которые временно генерируются в памяти программой **HFZ-iWatch** (работает только на macOS) в процессе работы с Apple Watch (включая выполнение Checkm8, изменение SN/WIFI/BT, получение FMI:OFF).  
Эти файлы существуют только во временной памяти и не записываются на диск из-за строгих защит от отладки и анализа.

### Требования  
1. **Ожидаемый результат:**  
   - Успешно получить рабочие копии файлов `ibss`, `ibec`, `diag` для конкретной модели Apple Watch.
   - Файлы должны быть доступны для последующего анализа/модификации **без необходимости повторного запуска HFZ-iWatch**.

2. **Ограничения:**  
   - Программа не предоставляет функцию прямого экспорта.
   - Временные файлы не сохраняются в стандартных директориях файловой системы.
   - Присутствуют современные механизмы противодействия отладке, подмене и анализу ПО.
   - **Все исследуемые и реализуемые методы должны быть совместимы с macOS.**

3. **Возможные технические подходы:**  
   - Захват данных **в момент генерации в памяти** или при взаимодействии с устройством.
   - Использование нативных macOS-инструментов для мониторинга файловой системы, процессов, памяти, API.
   - Применение обратного инжиниринга, форензики, дампов памяти, перехвата API и техник обхода защиты, адаптированных для macOS.

---

### Возможные методы решения (специфика macOS):

1. **Мониторинг файловой системы и системных вызовов:**  
    - Использовать `fs_usage`, `dtrace` или `opensnoop` для отслеживания операций создания, изменения и удаления файлов — особенно в директориях `/private/var/folders` или `/tmp`.
    - В режиме реального времени фиксировать появление и удаление временных файлов.

2. **Анализ памяти процесса:**  
    - Создавать дампы памяти процесса HFZ-iWatch в ключевые моменты генерации данных с помощью `lldb` или утилиты `Sample` (`sample <PID> <seconds>`).
    - Изучать области памяти с помощью анализаторов вроде `vmmap`, извлекать бинарные блоки, соответствующие сигнатурам ibss/ibec/diag.
    - Использовать `strings`, `xxd` либо скрипты на Python для поиска и извлечения данных в дампах памяти.

3. **Перехват системных API и внедрение кода:**  
    - Применять динамическую инструментализацию и перехват с помощью **Frida** или скриптов **DTrace** для перехвата вызовов `write`, `open` и других (или пользовательских процедур работы с файлами/устройствами).
    - Рассматривать перехват функций в коде на Objective-C/Swift или C/C++.

4. **Обратный инжиниринг:**  
    - Использовать **Hopper Disassembler**, **Ghidra** или **IDA Pro** (для macOS) для статического анализа бинарных файлов HFZ-iWatch.
    - Находить функции, отвечающие за подготовку файлов, передачу устройству или работу с временными данными.

5. **Перехват сетевого или USB-трафика:**  
    - В случае наличия передачи данных по сети или через USB — анализировать трафик с помощью **Wireshark** на macOS.
    - Для USB — использовать `ios-deploy`, `usbmuxd` либо специализированные инструменты мониторинга для macOS.

6. **Форензика и работа в изолированной среде:**  
    - Использовать снимки виртуальной macOS-машины для сравнения состояния системы до и после работы HFZ-iWatch.
    - Применять кейлог файловой системы (`fsevents`), просмотр истории изменений.

7. **Обход защиты от отладки и анализа:**  
    - Использовать **lldb** в steath-режиме, при необходимости патчить антиотладочные проверки.
    - Отключать или модифицировать известные macOS-антиотладочные или анти-VM механизмы.
    - В крайних случаях — рассматривать загрузку расширений ядра для глубоких перехватов (крайне осторожно и только при необходимости).

---

### Требования к отчётности и результату

1. **Детальное описание выбранных методов** и обоснование их применения.
2. **Полный перечень используемых инструментов** с примерами команд или конфигов.
3. **Извлечённые файлы:** имена, размеры, контрольные суммы (MD5/SHA1), описание формата.
4. **Скриншоты и подробные логи** каждого шага извлечения и анализа.
5. **Рекомендации по автоматизации** и повторному использованию процесса.

---

#### Юридическое уведомление:  
Все действия должны осуществляться с соблюдением законодательства и исключительно с теми устройствами/ПО, на которые у вас есть легальное право.

---

**Если нужно расширить или уточнить отдельные пункты, пожалуйста, укажите, какие аспекты требуют дополнительного освещения.**
